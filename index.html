<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube â†’ WAV</title>

  <link rel="stylesheet" href="https://pyscript.net/releases/2026.2.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2026.2.1/core.js"></script>

  <style>
    :root {
      --purple: #7c3aed;
      --purple-light: #8b5cf6;
      --bg: #0f0f13;
      --card: #1a1a24;
      --border: #2e2e42;
      --text: #f0f0f5;
      --muted: #8888aa;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 40px 36px;
      width: 100%; max-width: 560px;
      box-shadow: 0 0 60px rgba(124,58,237,0.15);
    }
    .logo {
      display: flex; align-items: center; justify-content: center;
      gap: 12px; margin-bottom: 6px;
    }
    .logo-icon {
      width: 46px; height: 46px;
      background: linear-gradient(135deg, var(--purple), var(--purple-light));
      border-radius: 13px;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px;
    }
    h1 { font-size: 26px; font-weight: 700; letter-spacing: -0.5px; }
    .subtitle { text-align: center; color: var(--muted); font-size: 14px; margin-bottom: 30px; }

    .input-row { display: flex; gap: 10px; margin-bottom: 16px; }
    input {
      flex: 1;
      background: var(--bg);
      border: 1.5px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 15px;
      padding: 14px 16px;
      outline: none;
      transition: border-color 0.2s;
    }
    input:focus { border-color: var(--purple-light); }
    input::placeholder { color: var(--muted); }

    #btn {
      background: linear-gradient(135deg, var(--purple), var(--purple-light));
      color: white; border: none;
      border-radius: 12px;
      font-size: 15px; font-weight: 600;
      padding: 14px 22px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
      white-space: nowrap;
    }
    #btn:hover:not(:disabled) { opacity: 0.88; transform: translateY(-1px); }
    #btn:disabled { opacity: 0.35; cursor: not-allowed; }

    .progress-wrap {
      height: 5px; background: var(--border);
      border-radius: 99px; overflow: hidden;
      margin-bottom: 14px; display: none;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--purple), var(--purple-light));
      border-radius: 99px;
      animation: indeterminate 1.3s ease-in-out infinite;
    }
    @keyframes indeterminate {
      0%   { transform: translateX(-100%) scaleX(0.4); }
      50%  { transform: translateX(60%)   scaleX(0.8); }
      100% { transform: translateX(300%)  scaleX(0.4); }
    }

    #status {
      display: none;
      border-radius: 12px;
      padding: 13px 16px;
      font-size: 13.5px; line-height: 1.65;
      margin-bottom: 14px;
      white-space: pre-wrap;
    }
    #status.info    { display:block; background:rgba(124,58,237,.13); color:#c4b5fd; border:1px solid rgba(124,58,237,.35); }
    #status.success { display:block; background:rgba(34,197,94,.1);   color:#86efac; border:1px solid rgba(34,197,94,.35); }
    #status.error   { display:block; background:rgba(239,68,68,.1);   color:#fca5a5; border:1px solid rgba(239,68,68,.35); }

    #videoCard {
      display: none;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 14px; overflow: hidden;
      margin-bottom: 14px;
    }
    #videoCard img { width: 100%; height: 175px; object-fit: cover; display: block; }
    .video-meta { padding: 12px 14px; }
    #videoTitle { font-weight:600; font-size:14px; margin-bottom:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    #videoChannel { font-size:12px; color:var(--muted); }

    #downloadBtn {
      display: none; width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #15803d, #22c55e);
      color: white; border: none;
      border-radius: 12px;
      font-size: 16px; font-weight: 700;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
    }
    #downloadBtn:hover { opacity: 0.9; transform: translateY(-1px); }

    .footer { text-align:center; margin-top:22px; font-size:12px; color:var(--muted); }

    /* hide pyscript loading splash */
    #py-internal-loading { display: none !important; }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo">
      <div class="logo-icon">ğŸµ</div>
      <h1>YouTube â†’ WAV</h1>
    </div>
    <p class="subtitle">Paste a YouTube link and download as WAV instantly</p>

    <div class="input-row">
      <input id="urlInput" type="text" placeholder="https://youtube.com/watch?v=..." autocomplete="off" />
      <button id="btn">Convert</button>
    </div>

    <div class="progress-wrap" id="progressWrap">
      <div class="progress-bar"></div>
    </div>

    <div id="status"></div>

    <div id="videoCard">
      <img id="videoThumb" src="" alt="" />
      <div class="video-meta">
        <div id="videoTitle"></div>
        <div id="videoChannel"></div>
      </div>
    </div>

    <button id="downloadBtn">â¬‡ Download WAV</button>

    <p class="footer">Powered by cobalt.tools Â· No account needed Â· Runs in your browser</p>
  </div>

  <script type="py" config='{"packages": ["pyodide-http"]}'>
import re
import json
import js
import asyncio
from pyscript import when
import pyodide_http

pyodide_http.patch_all()

# â”€â”€ state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
_state = {"download_url": None, "title": "audio"}

# â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def set_status(msg, kind):
    el = js.document.getElementById("status")
    el.textContent = msg
    el.className = kind

def set_progress(show):
    js.document.getElementById("progressWrap").style.display = "block" if show else "none"

def extract_video_id(url):
    for pat in [r"[?&]v=([^&\n?#]+)", r"youtu\.be/([^&\n?#?]+)", r"shorts/([^&\n?#]+)"]:
        m = re.search(pat, url)
        if m:
            return m.group(1)
    return None

def is_youtube_url(url):
    return bool(re.match(r"^(https?://)?(www\.)?(youtube\.com|youtu\.be)/.+", url))

# â”€â”€ fetch video info via oEmbed (no auth) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def fetch_video_info(video_id):
    import urllib.request
    oembed = f"https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v={video_id}&format=json"
    try:
        with urllib.request.urlopen(oembed) as r:
            return json.loads(r.read().decode())
    except Exception:
        return None

# â”€â”€ main convert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@when("click", "#btn")
async def on_convert(event):
    url = js.document.getElementById("urlInput").value.strip()
    btn = js.document.getElementById("btn")

    # reset UI
    js.document.getElementById("status").className = ""
    js.document.getElementById("videoCard").style.display = "none"
    js.document.getElementById("downloadBtn").style.display = "none"
    _state["download_url"] = None

    if not url:
        set_status("Please paste a YouTube URL.", "error")
        return
    if not is_youtube_url(url):
        set_status("That doesn't look like a YouTube URL.", "error")
        return

    video_id = extract_video_id(url)
    if not video_id:
        set_status("Could not extract video ID from URL.", "error")
        return

    btn.disabled = True
    set_progress(True)
    set_status("Fetching video infoâ€¦", "info")

    # â”€â”€ video info â”€â”€
    info = fetch_video_info(video_id)
    if info:
        _state["title"] = info.get("title", "audio")
        js.document.getElementById("videoTitle").textContent  = info.get("title", "")
        js.document.getElementById("videoChannel").textContent = info.get("author_name", "")
        js.document.getElementById("videoThumb").src = f"https://i.ytimg.com/vi/{video_id}/hqdefault.jpg"
        js.document.getElementById("videoCard").style.display = "block"

    set_status("Requesting download link from cobalt.toolsâ€¦", "info")

    # â”€â”€ cobalt.tools API â”€â”€
    import urllib.request
    clean_url = f"https://www.youtube.com/watch?v={video_id}"
    payload = json.dumps({
        "url": clean_url,
        "downloadMode": "audio",
        "audioFormat": "wav",
        "audioQuality": "320"
    }).encode()

    req = urllib.request.Request(
        "https://api.cobalt.tools/",
        data=payload,
        headers={
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        method="POST"
    )

    try:
        with urllib.request.urlopen(req) as r:
            data = json.loads(r.read().decode())

        status = data.get("status", "")

        if status in ("stream", "redirect", "tunnel"):
            _state["download_url"] = data["url"]
            set_status("âœ… Ready! Click the button below to download.", "success")
            js.document.getElementById("downloadBtn").style.display = "block"

        elif status == "picker":
            items = data.get("picker", [])
            if items:
                _state["download_url"] = items[0]["url"]
                set_status("âœ… Ready! Click the button below to download.", "success")
                js.document.getElementById("downloadBtn").style.display = "block"
            else:
                raise Exception("Empty picker response")

        elif status == "error":
            code = data.get("error", {}).get("code", "unknown")
            raise Exception(f"cobalt error: {code}")

        else:
            raise Exception(f"Unexpected status: {status!r}")

    except Exception as e:
        set_status(f"âŒ {e}\n\nTry a different video or retry in a moment.", "error")

    finally:
        btn.disabled = False
        set_progress(False)


# â”€â”€ download button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@when("click", "#downloadBtn")
async def on_download(event):
    dl_url = _state.get("download_url")
    title  = _state.get("title", "audio")
    if not dl_url:
        return

    set_status("Downloadingâ€¦ large videos may take a minute.", "info")
    set_progress(True)

    # Trigger via JS anchor click (most reliable cross-browser)
    a = js.document.createElement("a")
    a.href = dl_url
    a.download = f"{title}.wav"
    a.target = "_blank"
    js.document.body.appendChild(a)
    a.click()
    js.document.body.removeChild(a)

    set_status("âœ… Download started! Check your downloads folder.", "success")
    set_progress(False)


# â”€â”€ Enter key on input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@when("keydown", "#urlInput")
async def on_keydown(event):
    if event.key == "Enter":
        await on_convert(event)
  </script>
</body>
</html>
